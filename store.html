<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atheron SMP | Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        dark: { 900: '#050505', 800: '#0a0a0a', 700: '#111111', 600: '#1a1a1a' },
                        accent: { blue: '#3b82f6', purple: '#8b5cf6', gold: '#fbbf24', pink: '#ec4899' }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            color: white;
            background-image: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
        }
        .step-transition { transition: all 0.3s ease-in-out; }
        .payment-option.selected { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.05); }
        
        /* Tab Menu Styles */
        .nav-link { padding: 0.5rem 1rem; border-radius: 0.5rem; transition: all 0.2s; }
        .nav-link.active { background-color: rgba(255, 255, 255, 0.1); color: white; }
        .nav-link:not(.active):hover { background-color: rgba(255, 255, 255, 0.05); color: white; }

        /* Custom Currency/Category Toggles */
        .toggle-btn { transition: all 0.2s; border: 1px solid rgba(255,255,255,0.1); }
        .toggle-btn.active { background: white; color: black; font-weight: 800; border-color: white; box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .toggle-btn:not(.active) { background: #0a0a0f; color: #888; }
        .toggle-btn:not(.active):hover { color: white; border-color: rgba(255,255,255,0.3); }

        .cat-btn { transition: all 0.2s; }
        .cat-btn.active { background: #ef4444; color: white; border-color: #ef4444; }
        .cat-btn:not(.active) { background: transparent; border: 1px solid rgba(255,255,255,0.1); color: #888; }
        .cat-btn:not(.active):hover { border-color: rgba(255,255,255,0.3); color: white; }

        /* Modal Transitions */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 0.3s ease, transform 0.3s ease; }
        .modal-exit { opacity: 0; transform: scale(0.95); transition: opacity 0.2s ease, transform 0.2s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans antialiased">

    <nav class="border-b border-white/5 bg-dark-800/50 backdrop-blur-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="https://i.postimg.cc/Vk278f4Q/file-000000007c7c720680ea04894073b7d8.webp" alt="Atheron SMP" class="w-10 h-10 rounded-lg shadow-lg shadow-purple-900/20 object-cover">
                <span class="font-bold text-xl tracking-wide">ATHERON SMP</span>
            </div>
            <div class="hidden md:flex items-center gap-4 text-sm font-medium text-gray-400">
                <a href="index.html" class="nav-link">Home</a>
                <a href="store.html" class="nav-link active">Store</a>
                <a href="https://discord.gg/xnmKmfsggt" target="_blank" class="nav-link">Discord</a>
            </div>
            <button onclick="openDiscordModal()" class="bg-white text-black px-5 py-2 rounded-full font-semibold text-sm hover:bg-gray-200 transition-colors">Support</button>
        </div>
    </nav>

    <header class="pt-20 pb-10 text-center relative overflow-hidden">
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-accent-purple/20 blur-[100px] rounded-full pointer-events-none"></div>
        <h1 class="text-5xl md:text-6xl font-black mb-4 tracking-tight">CHOOSE YOUR RANK</h1>
        <p class="text-gray-400 text-lg max-w-2xl mx-auto mb-10">Enhance your experience on Atheron SMP with exclusive perks, kits, and abilities.</p>
        
        <div class="max-w-3xl mx-auto px-6 flex flex-col gap-6 items-center">
            
            <div class="flex items-center gap-4 bg-[#050508] border border-white/5 p-2 rounded-2xl">
                <span class="text-xs font-bold text-blue-400 pl-2 uppercase tracking-widest">Select Currency:</span>
                <div class="flex gap-2">
                    <button onclick="setCurrency('USD')" id="curr-USD" class="toggle-btn active px-4 py-1.5 rounded-xl text-xs font-bold">USD</button>
                    <button onclick="setCurrency('INR')" id="curr-INR" class="toggle-btn px-4 py-1.5 rounded-xl text-xs font-bold">INR</button>
                    <button onclick="setCurrency('PHP')" id="curr-PHP" class="toggle-btn px-4 py-1.5 rounded-xl text-xs font-bold">PHP</button>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="filterCategory('all')" id="cat-all" class="cat-btn active px-8 py-3 rounded-xl text-sm font-black tracking-wide uppercase">ALL</button>
                <button onclick="filterCategory('ranks')" id="cat-ranks" class="cat-btn px-8 py-3 rounded-xl text-sm font-black tracking-wide uppercase">RANKS</button>
                <button onclick="filterCategory('items')" id="cat-items" class="cat-btn px-8 py-3 rounded-xl text-sm font-black tracking-wide uppercase">ITEMS</button>
            </div>

        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 pb-32">
        <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
            <!-- Products will be injected here via JS -->
        </div>
        
        <div id="noItemsMsg" class="hidden text-center py-20">
            <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i data-lucide="package-open" class="w-8 h-8 text-gray-500"></i>
            </div>
            <h3 class="text-xl font-bold text-white">No Items Found</h3>
            <p class="text-gray-500 text-sm mt-2">Check back later for new items.</p>
        </div>
    </main>

    <div id="modalOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div id="modalContent" class="bg-[#050508] border border-white/10 w-full max-w-md rounded-3xl overflow-hidden shadow-2xl relative min-h-[500px] flex flex-col">
            <button onclick="closeModal()" class="absolute top-6 right-6 z-20"><i data-lucide="x" class="w-6 h-6 text-gray-400"></i></button>

            <div id="progressBar" class="absolute top-0 left-0 h-1 bg-gradient-to-r from-pink-500 to-blue-500 transition-all duration-500" style="width: 33%"></div>

            <div class="p-8 flex-1 flex flex-col">
                
                <div id="step1" class="step-transition flex-1 flex flex-col">
                    <h2 class="text-4xl font-black text-white tracking-tight mb-2">IDENTITY</h2>
                    <div class="text-xs font-bold text-gray-500 mb-8">STEP 1 OF 3 â€¢ <span class="modalRankName">RANK</span></div>
                    
                    <label class="block text-xs font-bold text-gray-500 mb-2">YOUR MINECRAFT USERNAME</label>
                    <input type="text" id="ignInput" placeholder="Enter IGN..." class="w-full bg-[#0f0f13] border border-white/5 text-white text-sm rounded-xl py-4 px-4 mb-6 focus:outline-none focus:border-blue-500">

                    <label class="block text-xs font-bold text-gray-500 mb-2">YOUR EMAIL ADDRESS</label>
                    <input type="email" id="emailInput" placeholder="name@example.com" class="w-full bg-[#0f0f13] border border-white/5 text-white text-sm rounded-xl py-4 px-4 mb-6 focus:outline-none focus:border-blue-500">

                    <div id="bogoSection" class="hidden mb-6 p-4 bg-blue-900/20 border border-blue-500/20 rounded-xl">
                        <p class="text-xs text-blue-200 mb-2">BOGO OFFER: Enter friend's IGN for free rank!</p>
                        <input type="text" id="friendIgnInput" placeholder="Friend's IGN" class="w-full bg-[#050508] border border-blue-500/30 text-white text-sm rounded-lg py-3 px-4 focus:outline-none focus:border-blue-500">
                    </div>

                    <button onclick="goToStep2()" class="mt-auto w-full bg-white hover:bg-gray-100 text-black font-bold py-4 rounded-xl flex items-center justify-center gap-2">
                        <span>CHOOSE PAYMENT METHOD</span> <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>

                <div id="step2" class="hidden step-transition flex-1 flex flex-col">
                    <h2 class="text-4xl font-black text-white tracking-tight mb-2">PAYMENT</h2>
                    <div class="text-xs font-bold text-gray-500 mb-8">STEP 2 OF 3 â€¢ <span class="modalRankName">RANK</span></div>

                    <div class="space-y-4 mb-8">
                        <div onclick="selectPayment('crypto')" id="pay-crypto" class="payment-option cursor-pointer bg-[#0a0a0f] border border-white/5 rounded-2xl p-4 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center"><i data-lucide="globe" class="text-white"></i></div>
                            <div><div class="font-bold text-white text-sm">OTHER CURRENCY BDT/PKR/CRYPTO</div><div class="text-[10px] text-gray-500 font-bold uppercase">SECURE GATEWAY</div></div>
                        </div>
                        <div onclick="selectPayment('paypal')" id="pay-paypal" class="payment-option cursor-pointer bg-[#0a0a0f] border border-white/5 rounded-2xl p-4 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-sky-500 flex items-center justify-center"><i data-lucide="dollar-sign" class="text-white"></i></div>
                            <div><div class="font-bold text-white text-sm">PayPal</div><div class="text-[10px] text-gray-500 font-bold uppercase">SECURE GATEWAY</div></div>
                        </div>
                        <div onclick="selectPayment('upi')" id="pay-upi" class="payment-option cursor-pointer bg-[#0a0a0f] border border-white/5 rounded-2xl p-4 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-orange-500 flex items-center justify-center"><i data-lucide="smartphone" class="text-white"></i></div>
                            <div><div class="font-bold text-white text-sm">Indian [UPI]</div><div class="text-[10px] text-gray-500 font-bold uppercase">SECURE GATEWAY</div></div>
                        </div>
                    </div>

                    <button onclick="generateReceipt()" class="mt-auto w-full bg-gradient-to-r from-red-500 to-blue-600 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg">
                        <span>GENERATE MY RECEIPT</span> <i data-lucide="sparkles" class="w-5 h-5"></i>
                    </button>
                </div>

                <div id="step3" class="hidden step-transition flex-1 flex flex-col items-center justify-center h-full">
                    
                    <div id="receiptContainer" class="w-full bg-[#050508] p-1 rounded-3xl">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-3xl font-black text-white">RECEIPT</h2>
                                <div class="text-[10px] font-bold tracking-widest text-gray-500 uppercase mt-1">STEP 3 OF 3</div>
                            </div>
                            <div class="w-8 h-8 rounded-full border border-white/10 flex items-center justify-center">
                                <i data-lucide="check" class="w-4 h-4 text-white"></i>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-[#0a0a0f] to-[#1e1b4b] border border-purple-500/30 rounded-2xl p-6 relative overflow-hidden shadow-[0_0_40px_rgba(139,92,246,0.1)]">
                            <div class="absolute top-0 right-0 p-6 opacity-5 pointer-events-none">
                                <i data-lucide="qr-code" class="w-32 h-32 text-white"></i>
                            </div>

                            <div class="flex justify-between items-start mb-8 relative z-10">
                                <div>
                                    <h3 class="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-200 tracking-wide">OFFICIAL RECEIPT</h3>
                                    <p class="text-[10px] text-gray-500 font-mono tracking-widest mt-1">TXN <span id="receiptTxn">#SP1YXUOLM</span></p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[9px] text-gray-500 font-bold tracking-widest uppercase">DATE</p>
                                    <p class="text-xs text-white font-bold" id="receiptDate">1/27/2026</p>
                                </div>
                            </div>

                            <div class="space-y-4 mb-8 relative z-10">
                                <div class="grid grid-cols-2 gap-4 border-b border-purple-500/10 pb-3">
                                    <div class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">CUSTOMER IGN</div>
                                    <div class="text-right text-xs font-bold text-white" id="receiptIgn">Steve</div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 border-b border-purple-500/10 pb-3">
                                    <div class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">EMAIL</div>
                                    <div class="text-right text-xs font-bold text-white" id="receiptEmail">email@example.com</div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 border-b border-purple-500/10 pb-3">
                                    <div class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">PRODUCT</div>
                                    <div class="text-right text-xs font-bold text-white" id="receiptProduct">Rank</div>
                                </div>
                                <div id="receiptBogoRow" class="hidden grid grid-cols-2 gap-4 border-b border-purple-500/10 pb-3">
                                    <div class="text-[10px] font-bold text-blue-400 uppercase tracking-wider">BOGO TARGET</div>
                                    <div class="text-right text-xs font-bold text-blue-100" id="receiptBogoTarget">Alex</div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 border-b border-purple-500/10 pb-3">
                                    <div class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">METHOD</div>
                                    <div class="text-right text-xs font-bold text-white uppercase" id="receiptMethod">UPI</div>
                                </div>
                            </div>

                            <div class="flex justify-between items-center mb-8 relative z-10">
                                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">AMOUNT DUE</span>
                                <span class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 tracking-tight" id="receiptAmount">$13.99</span>
                            </div>

                            <div id="paymentQr" class="hidden flex flex-col items-center justify-center mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                                <!-- QR Code Injected Here -->
                            </div>

                            <div class="bg-[#050508]/50 border border-purple-500/10 rounded-xl p-4 relative z-10 backdrop-blur-sm">
                                <p class="text-[9px] text-gray-500 font-bold text-center uppercase tracking-widest mb-3">VERIFICATION STEPS</p>
                                <ul class="space-y-2 flex flex-col items-center">
                                    <li class="flex items-center gap-2 text-[10px] text-white italic">
                                        <span class="w-1 h-1 rounded-full bg-red-500"></span>
                                        Take a screenshot of this receipt
                                    </li>
                                    <li class="flex items-center gap-2 text-[10px] text-white italic">
                                        <span class="w-1 h-1 rounded-full bg-blue-500"></span>
                                        Open a ticket in #support-tickets
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 w-full mt-6">
                            <button onclick="downloadPdf()" class="py-3.5 rounded-xl bg-[#0a0a0f] border border-white/10 hover:bg-[#15151a] text-xs font-bold text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="download" class="w-4 h-4"></i> SAVE PDF
                            </button>
                            <a href="https://discord.gg/xnmKmfsggt" target="_blank" class="py-3.5 rounded-xl bg-gradient-to-r from-red-500 to-blue-600 hover:opacity-90 text-xs font-bold text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="copy" class="w-4 h-4"></i> OPEN TICKET
                            </a>
                    </div>
                    <div class="mt-4 text-[8px] font-bold tracking-[0.2em] text-gray-700 uppercase">Powered by Atheron SMP Store Integration</div>
                </div>

            </div>
        </div>
    </div>

    <div id="discordModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div id="discordContent" class="bg-[#0f0f15] border border-indigo-500/20 w-full max-w-md rounded-2xl overflow-hidden shadow-[0_0_50px_rgba(79,70,229,0.15)] relative transform transition-all text-center p-8 modal-enter">
            <button onclick="closeDiscordModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div class="w-16 h-16 bg-[#5865F2]/10 rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="message-square" class="w-8 h-8 text-[#5865F2]"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-3">Need Support?</h2>
            <p class="text-gray-400 text-sm leading-relaxed mb-8">
                Join our Discord server and open a ticket in <strong>#support-tickets</strong> for assistance with your purchase.
            </p>
            <a href="https://discord.gg/xnmKmfsggt" target="_blank" class="block w-full py-3.5 bg-gradient-to-r from-red-500 to-indigo-600 rounded-xl font-bold text-white hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
                <i data-lucide="external-link" class="w-4 h-4"></i>
                Join Discord Server
            </a>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let currentRank = "", currentPrice = "", currentInrPrice = "", selectedPayment = "";
        let currentCurrency = "USD";
        let allProducts = [];

        // --- Store Data Initialization ---
        const defaultProducts = [
            {
                id: 'rank_supporter', name: 'Supporter', category: 'ranks',
                prices: { USD: 0.6, INR: 50, PHP: 35 },
                tag: '1 SEASON', color: 'blue',
                features: ['Unique Discord & In-game Prefix', '1 Kit every 4 days', 'Duel any Ranked player (every 6 days)', 'Extra Homes Total 3']
            },
            {
                id: 'rank_supporter_plus', name: 'Supporter +', category: 'ranks',
                prices: { USD: 2.3, INR: 200, PHP: 135 },
                tag: '1 SEASON', color: 'purple',
                features: ['Unique Discord & In-game Prefix', '1 Kit every 2 days', 'Duel any Ranked player (every 4 days)', 'Extra Homes Total 6']
            },
            {
                id: 'rank_athronix', name: 'ATHRONIX', category: 'ranks',
                prices: { USD: 12.99, INR: 1100, PHP: 750 },
                tag: 'PERMANENT', color: 'yellow', highlight: true,
                features: ['Unique Discord & In-game Prefix', '3 Kits every 1 day', 'Duel any Ranked player (every 2 days)', 'Extra Homes Total 9', 'Custom EZ Recipes'],
                isBogo: true
            }
        ];

        function loadStore() {
            let products = JSON.parse(localStorage.getItem('storeProducts'));
            if (!products || products.length === 0) {
                products = defaultProducts;
                localStorage.setItem('storeProducts', JSON.stringify(products));
            }
            allProducts = products;
            filterCategory('all');
        }

        function renderProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            products.forEach(p => {
                const isHighlight = p.highlight;
                const color = p.color || 'blue';
                const borderColor = color === 'yellow' ? 'border-yellow-500/50' : (color === 'purple' ? 'hover:border-purple-500/50' : 'hover:border-blue-500/50');
                const textColor = color === 'yellow' ? 'text-yellow-500' : (color === 'purple' ? 'text-purple-500' : 'text-blue-500');
                const btnClass = isHighlight ? 'bg-white hover:bg-gray-200 text-black shadow-lg hover:-translate-y-1' : 'bg-[#1a1a1a] hover:bg-[#262626] text-white border border-white/5';
                
                let featuresHtml = p.features.map(f => `
                    <li class="flex items-start gap-3 text-sm text-gray-400">
                        <i data-lucide="${color === 'yellow' ? 'check' : 'check'}" class="w-4 h-4 ${textColor} shrink-0"></i> ${f}
                    </li>
                `).join('');

                const html = `
                    <div class="product-card ${p.category}-card relative bg-[#0a0a0a] border ${isHighlight ? 'border-yellow-500/50 shadow-[0_0_30px_rgba(234,179,8,0.1)] transform md:-translate-y-4' : 'border-white/5'} ${borderColor} rounded-2xl p-${isHighlight ? '8' : '6'} transition-colors flex flex-col h-full group">
                        ${isHighlight ? '<div class="absolute top-0 right-0 bg-yellow-500 text-black text-xs font-bold px-3 py-1 rounded-bl-xl">PERMANENT</div>' : ''}
                        <div class="mb-6">
                            <h3 class="text-${isHighlight ? '3xl' : '2xl'} font-bold ${isHighlight ? 'text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500' : 'text-gray-100'}">${p.name}</h3>
                            <div class="mt-2 flex items-baseline gap-2">
                                <span class="price-display text-${isHighlight ? '4xl' : '3xl'} font-bold text-white" data-usd="${p.prices.USD}" data-inr="${p.prices.INR}" data-php="${p.prices.PHP}">$${p.prices.USD}</span> 
                            </div>
                            <div class="mt-3 flex gap-2 flex-wrap">
                                <div class="text-xs font-bold ${textColor} ${color === 'yellow' ? 'bg-yellow-500/10' : (color === 'purple' ? 'bg-purple-400/10' : 'bg-blue-400/10')} px-3 py-1 rounded inline-block">${p.tag}</div>
                                ${p.isBogo ? '<div class="text-xs font-bold text-white bg-red-600 px-2 py-1 rounded animate-pulse">BUY 1 GET 1 FREE</div>' : ''}
                            </div>
                        </div>
                        <ul class="space-y-3 mb-8 flex-1">
                            ${featuresHtml}
                        </ul>
                        <button onclick="initModal('${p.name}', this, ${p.isBogo || false})" class="w-full py-${isHighlight ? '4' : '3'} ${btnClass} font-semibold rounded-xl transition-all">Redeem Now</button>
                    </div>
                `;
                grid.innerHTML += html;
            });
            lucide.createIcons();
            setCurrency(currentCurrency); // Re-apply currency
        }

        // --- Currency & Category Logic ---
        function setCurrency(curr) {
            currentCurrency = curr;
            // Update Buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('curr-' + curr).classList.add('active');

            // Update Prices
            document.querySelectorAll('.price-display').forEach(el => {
                const price = el.getAttribute('data-' + curr.toLowerCase());
                if(curr === 'USD') el.innerText = '$' + price;
                else if(curr === 'INR') el.innerText = 'â‚¹' + price;
                else if(curr === 'PHP') el.innerText = 'â‚±' + price;
            });
        }

        function filterCategory(cat) {
            // Update Buttons
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('cat-' + cat).classList.add('active');

            // Filter Logic
            const filtered = cat === 'all' ? allProducts : allProducts.filter(p => p.category === cat);

            if (filtered.length === 0) {
                document.getElementById('productsGrid').classList.add('hidden');
                document.getElementById('noItemsMsg').classList.remove('hidden');
            } else {
                document.getElementById('productsGrid').classList.remove('hidden');
                document.getElementById('noItemsMsg').classList.add('hidden');
                renderProducts(filtered);
            }
        }

        // --- Modal Logic ---
        function initModal(rankName, btnElement, isBogo = false) {
            // Get current price text based on active currency
            const priceText = btnElement.parentElement.querySelector('.price-display').innerText;
            // Store INR price for UPI generation regardless of current display currency
            currentInrPrice = btnElement.parentElement.querySelector('.price-display').getAttribute('data-inr');
            openModal(rankName, priceText, isBogo);
        }

        function openModal(rankName, price, isBogo) {
            currentRank = rankName; currentPrice = price;
            document.getElementById('modalOverlay').classList.remove('hidden');
            document.querySelectorAll('.modalRankName').forEach(el => el.innerText = rankName.toUpperCase());
            
            // Reset
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('progressBar').style.width = '33%';
            document.getElementById('ignInput').value = "";
            document.getElementById('emailInput').value = "";
            document.getElementById('friendIgnInput').value = "";
            document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('selected'));
            selectedPayment = "";
            
            const bogoSection = document.getElementById('bogoSection');
            if(isBogo) bogoSection.classList.remove('hidden'); else bogoSection.classList.add('hidden');
        }

        function closeModal() { document.getElementById('modalOverlay').classList.add('hidden'); }

        // --- Discord Modal Logic ---
        const discordModal = document.getElementById('discordModal');
        const discordContent = document.getElementById('discordContent');

        function openDiscordModal() {
            discordModal.classList.remove('hidden');
            setTimeout(() => { discordContent.classList.remove('modal-enter'); discordContent.classList.add('modal-enter-active'); }, 10);
        }

        function closeDiscordModal() {
            discordContent.classList.add('modal-exit'); discordContent.classList.remove('modal-enter-active');
            setTimeout(() => { discordModal.classList.add('hidden'); discordContent.classList.remove('modal-exit'); discordContent.classList.add('modal-enter'); }, 200);
        }

        function goToStep2() {
            if(!document.getElementById('ignInput').value) return alert("Enter Username!");
            if(!document.getElementById('emailInput').value) return alert("Enter Email!");
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            document.getElementById('progressBar').style.width = '66%';
        }

        function selectPayment(method) {
            selectedPayment = method;
            document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('pay-' + method).classList.add('selected');
        }

        function generateReceipt() {
            if(!selectedPayment) return alert("Select Payment Method!");
            
            const ign = document.getElementById('ignInput').value;
            const email = document.getElementById('emailInput').value;
            const friendIgn = document.getElementById('friendIgnInput').value;
            const today = new Date();

            document.getElementById('receiptIgn').innerText = ign;
            document.getElementById('receiptEmail').innerText = email;
            document.getElementById('receiptProduct').innerText = currentRank;
            
            // Format Payment Method Text
            let methodText = selectedPayment;
            if(selectedPayment === 'crypto') methodText = "Other/Crypto";
            else methodText = selectedPayment.toUpperCase();
            
            document.getElementById('receiptMethod').innerText = methodText;
            document.getElementById('receiptAmount').innerText = currentPrice;
            document.getElementById('receiptDate').innerText = `${today.getMonth()+1}/${today.getDate()}/${today.getFullYear()}`;
            const txnId = '#ATH-' + Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('receiptTxn').innerText = txnId;

            // UPI QR Code Logic
            const qrContainer = document.getElementById('paymentQr');
            if(selectedPayment === 'upi') {
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=baponsarkar@fam&pn=AtheronSMP&am=${currentInrPrice}&cu=INR`;
                qrContainer.innerHTML = `<div class="text-[10px] font-bold text-gray-400 uppercase mb-2">Scan to Pay (â‚¹${currentInrPrice})</div><img src="${qrUrl}" alt="UPI QR" class="w-32 h-32 rounded-lg border-4 border-white">`;
                qrContainer.classList.remove('hidden');
            } else {
                qrContainer.classList.add('hidden');
            }

            if(friendIgn) {
                document.getElementById('receiptBogoRow').classList.remove('hidden');
                document.getElementById('receiptBogoTarget').innerText = friendIgn;
            } else {
                document.getElementById('receiptBogoRow').classList.add('hidden');
            }

            // Save to LocalStorage for Admin Panel
            const newReceipt = {
                id: txnId,
                date: document.getElementById('receiptDate').innerText,
                ign: ign,
                email: email,
                product: currentRank,
                amount: currentPrice,
                status: 'Pending'
            };
            const receipts = JSON.parse(localStorage.getItem('adminReceipts') || '[]');
            receipts.push(newReceipt);
            localStorage.setItem('adminReceipts', JSON.stringify(receipts));
            
            // Send to Discord Webhook (Required for cross-device admin viewing)
            sendToDiscord(newReceipt);

            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('progressBar').style.width = '100%';
        }

        function sendToDiscord(receipt) {
            // REPLACE THIS WITH YOUR ACTUAL DISCORD WEBHOOK URL
            const webhookUrl = "YOUR_WEBHOOK_URL_HERE";
            
            if(webhookUrl === "YOUR_WEBHOOK_URL_HERE") return;

            const payload = {
                embeds: [{
                    title: "ðŸ§¾ New Store Receipt",
                    color: 5763719, // Green
                    fields: [
                        { name: "IGN", value: receipt.ign, inline: true },
                        { name: "Product", value: receipt.product, inline: true },
                        { name: "Amount", value: receipt.amount, inline: true },
                        { name: "Txn ID", value: receipt.id, inline: true },
                        { name: "Date", value: receipt.date, inline: true }
                    ],
                    footer: { text: "Atheron SMP Store System" },
                    timestamp: new Date().toISOString()
                }]
            };

            fetch(webhookUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            }).catch(err => console.error("Webhook Error:", err));
        }

        // --- PDF Logic ---
        function downloadPdf() {
            const element = document.getElementById('receiptContainer');
            const opt = {
                margin:       10,
                filename:     'Atheron_Receipt.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, backgroundColor: '#050508' },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        window.onclick = function(event) {
            if (event.target == discordModal) closeDiscordModal();
            if (event.target == document.getElementById('modalOverlay')) closeModal();
        }

        // Init
        loadStore();
    </script>
</body>
</html>
